# 07 - 开发计划

## 7.1 整体规划

### 开发周期

| 阶段 | 名称 | 目标 | 周期 |
|------|------|------|------|
| Phase 1 | MVP版本 | 核心功能可用 | 2周 |
| Phase 2 | AI核心 | AI功能完整 | 2周 |
| Phase 3 | 体验增强 | 完善用户体验 | 1.5周 |
| Phase 4 | 高级功能 | 增值功能 | 1.5周 |

**总计**: 7周（约2个月）

### 里程碑

```
Week 1-2   │ Phase 1: MVP
           │ ✓ 用户认证
           │ ✓ 数据CRUD
           │ ✓ 文件上传预览
           │
Week 3-4   │ Phase 2: AI Core
           │ ✓ 课程表识别
           │ ✓ 任务识别
           │ ✓ AI文件摘要
           │
Week 5-6   │ Phase 3: Enhancement
           │ ✓ 通知提醒
           │ ✓ 专注统计
           │ ✓ 离线支持
           │
Week 7     │ Phase 4: Advanced
           │ ✓ 日/月视图
           │ ✓ 设置页面
           │ ✓ 优化调试
```

---

## 7.2 Phase 1: MVP版本（2周）

### 目标
完成基础功能，使小程序可用于日常学习管理。

### 功能清单

#### Week 1: 认证与数据基础

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| 微信登录Edge Function | P0 | 4h | - |
| 登录页面UI | P0 | 2h | - |
| Token管理 | P0 | 2h | 登录函数 |
| 用户信息设置页 | P1 | 3h | 登录 |
| 课程添加页面 | P0 | 4h | 登录 |
| 课程编辑/删除 | P0 | 3h | 课程添加 |
| 任务添加页面 | P0 | 4h | 登录 |
| 任务编辑/删除 | P0 | 3h | 任务添加 |

**Week 1 总工时**: ~25h

#### Week 2: 文件与整合

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| Storage配置 | P0 | 2h | - |
| 文件上传功能 | P0 | 4h | Storage |
| 文件预览功能 | P0 | 3h | 上传 |
| 文件删除功能 | P1 | 2h | 上传 |
| 首页数据整合 | P0 | 4h | CRUD完成 |
| 全局错误处理 | P1 | 3h | - |
| 本地缓存优化 | P1 | 3h | - |
| Bug修复&测试 | P0 | 4h | 全部 |

**Week 2 总工时**: ~25h

### 交付标准

- [ ] 用户可以微信一键登录
- [ ] 用户可以添加/编辑/删除课程
- [ ] 用户可以添加/编辑/删除任务
- [ ] 用户可以上传/预览/删除资料
- [ ] 首页正确显示用户数据
- [ ] 无明显Bug，基本功能稳定

### 技术要点

**微信登录实现**:
```typescript
// Edge Function: wechat-login
async function wechatLogin(code: string) {
  // 1. 调用微信接口换取openid
  const wxRes = await fetch(
    `https://api.weixin.qq.com/sns/jscode2session?` +
    `appid=${APPID}&secret=${SECRET}&js_code=${code}&grant_type=authorization_code`
  );
  const { openid, session_key } = await wxRes.json();

  // 2. 查找或创建用户
  const { data: user } = await supabase
    .from('profiles')
    .select('*')
    .eq('wechat_openid', openid)
    .single();

  if (!user) {
    // 创建新用户
    const { data: newUser } = await supabase.auth.admin.createUser({
      email: `${openid}@wechat.placeholder`,
      password: crypto.randomUUID()
    });

    await supabase.from('profiles').insert({
      id: newUser.user.id,
      wechat_openid: openid
    });
  }

  // 3. 生成JWT
  const token = await supabase.auth.admin.generateLink({
    type: 'magiclink',
    email: user?.email || `${openid}@wechat.placeholder`
  });

  return { access_token: token, user };
}
```

---

## 7.3 Phase 2: AI核心功能（2周）

### 目标
实现AI图片识别和文件摘要，这是产品的核心卖点。

### 功能清单

#### Week 3: 图片识别

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| 腾讯云OCR接入 | P0 | 4h | - |
| DeepSeek LLM接入 | P0 | 3h | - |
| parse-schedule函数 | P0 | 6h | OCR+LLM |
| parse-task函数 | P0 | 4h | OCR+LLM |
| AI导入页面完善 | P0 | 4h | Edge函数 |
| 识别结果确认UI | P0 | 3h | 页面 |
| 批量导入逻辑 | P1 | 3h | 确认UI |
| 错误处理&重试 | P1 | 2h | - |

**Week 3 总工时**: ~29h

#### Week 4: 文件摘要

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| PDF文本提取 | P0 | 4h | - |
| PPT文本提取 | P1 | 4h | - |
| summarize-file函数 | P0 | 5h | 文本提取 |
| 摘要UI展示 | P0 | 3h | 函数 |
| 摘要缓存机制 | P1 | 2h | - |
| 长文本分块处理 | P1 | 3h | - |
| AI成本监控 | P2 | 2h | - |
| 集成测试 | P0 | 4h | 全部 |

**Week 4 总工时**: ~27h

### 交付标准

- [ ] 用户可以拍照识别课程表
- [ ] 用户可以截图识别任务通知
- [ ] 识别结果可以确认并导入
- [ ] 用户可以对PDF/PPT生成AI摘要
- [ ] 摘要结果可以保存和再次查看
- [ ] OCR和LLM调用稳定可靠

### 技术要点

**Prompt工程关键点**:

1. **结构化输出**: 要求LLM直接返回JSON
2. **低温度**: temperature=0.1 保证稳定
3. **示例引导**: 在Prompt中给出输出示例
4. **数据验证**: 服务端验证并修正数据

---

## 7.4 Phase 3: 体验增强（1.5周）

### 目标
提升用户体验，增加黏性功能。

### 功能清单

#### Week 5: 通知与统计

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| 订阅消息模板申请 | P0 | 1h | - |
| 课前提醒功能 | P0 | 4h | 模板 |
| Deadline提醒 | P0 | 4h | 模板 |
| 专注记录存储 | P0 | 3h | - |
| 专注统计页面 | P1 | 4h | 记录存储 |
| 连续天数计算 | P1 | 2h | - |
| 专注卡片保存 | P2 | 3h | - |

**Week 5 总工时**: ~21h

#### Week 6 前半: 离线与优化

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| 离线数据缓存 | P1 | 4h | - |
| 离线操作队列 | P1 | 4h | 缓存 |
| 网络恢复同步 | P1 | 3h | 队列 |
| 性能优化 | P1 | 3h | - |
| 空教室众包UI | P2 | 3h | - |

**Week 6 前半总工时**: ~17h

### 交付标准

- [ ] 用户可以收到课前15分钟提醒
- [ ] 用户可以收到deadline前1天提醒
- [ ] 专注记录自动保存
- [ ] 可以查看专注统计（今日/本周/连续天数）
- [ ] 离线时可查看缓存数据
- [ ] 网络恢复自动同步

---

## 7.5 Phase 4: 高级功能（1.5周）

### 目标
完善产品，增加差异化功能。

### 功能清单

#### Week 6 后半 + Week 7

| 任务 | 优先级 | 预估工时 | 依赖 |
|------|--------|----------|------|
| 日视图实现 | P1 | 5h | - |
| 月视图实现 | P1 | 5h | - |
| 视图切换联动 | P1 | 2h | 视图 |
| 设置页面 | P1 | 4h | - |
| 节次时间自定义 | P2 | 3h | 设置 |
| 主题切换(暗黑模式) | P2 | 4h | 设置 |
| 数据导出 | P2 | 3h | - |
| 全面测试&修复 | P0 | 6h | 全部 |
| 文档完善 | P1 | 3h | - |

**总工时**: ~35h

### 交付标准

- [ ] 周/日/月三个视图可切换
- [ ] 设置页面功能完整
- [ ] 可自定义节次时间
- [ ] 支持暗黑模式
- [ ] 全部功能测试通过
- [ ] 准备提交审核

---

## 7.6 任务详细拆解

### 用户认证任务拆解

```
用户认证系统
├── 后端
│   ├── [4h] Edge Function: wechat-login
│   │   ├── 微信接口调用
│   │   ├── 用户创建/查找
│   │   └── JWT生成
│   ├── [2h] Edge Function: refresh-token
│   └── [1h] 环境变量配置
│
├── 前端
│   ├── [2h] 登录页面UI
│   │   ├── Logo和Slogan
│   │   ├── 登录按钮
│   │   └── 协议链接
│   ├── [2h] Token管理
│   │   ├── 存储封装
│   │   ├── 自动刷新
│   │   └── 过期处理
│   └── [3h] 用户信息设置
│       ├── 表单UI
│       ├── 数据保存
│       └── 首次引导
│
└── 测试
    ├── 登录流程测试
    ├── Token过期测试
    └── 异常处理测试
```

### AI识别任务拆解

```
AI课程表识别
├── 后端
│   ├── [4h] OCR模块
│   │   ├── 腾讯云SDK封装
│   │   ├── 签名生成
│   │   └── 结果解析
│   ├── [3h] LLM模块
│   │   ├── DeepSeek API封装
│   │   ├── Prompt设计
│   │   └── JSON提取
│   └── [6h] parse-schedule函数
│       ├── 图片下载
│       ├── OCR调用
│       ├── LLM解析
│       └── 数据验证
│
├── 前端
│   ├── [4h] AI导入页面
│   │   ├── 图片选择
│   │   ├── 扫描动画
│   │   └── 进度显示
│   ├── [3h] 结果确认
│   │   ├── 卡片展示
│   │   ├── 编辑功能
│   │   └── 确认/取消
│   └── [3h] 批量导入
│       ├── 一键导入
│       ├── 数据写入
│       └── 结果反馈
│
└── 测试
    ├── 多种课表格式测试
    ├── 识别准确率评估
    └── 异常图片处理
```

---

## 7.7 风险管理

### 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| OCR识别率低 | 中 | 高 | 多OCR对比、人工纠错入口 |
| LLM解析不稳定 | 中 | 高 | Prompt迭代、结果验证 |
| Edge Function冷启动慢 | 低 | 中 | 预热机制、加载动画 |
| 文件提取失败 | 中 | 中 | 多库尝试、格式限制 |

### 进度风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 功能复杂度超预期 | 中 | 高 | 及时裁剪、优先核心 |
| 第三方服务问题 | 低 | 中 | 备选方案、降级策略 |
| 微信审核不通过 | 中 | 高 | 提前了解规则、预留时间 |

### 应急预案

1. **OCR失败**: 提供手动输入入口
2. **LLM超时**: 结果缓存、后台重试
3. **存储超限**: 压缩图片、清理临时文件
4. **审核被拒**: 准备合规说明材料

---

## 7.8 测试计划

### 单元测试

| 模块 | 测试内容 |
|------|----------|
| utils/date | 日期格式化、时间计算 |
| utils/supabase | API请求、错误处理 |
| utils/storage | 缓存读写、过期清理 |

### 集成测试

| 流程 | 测试用例 |
|------|----------|
| 登录流程 | 正常登录、Token刷新、登出 |
| 课程管理 | CRUD完整流程 |
| AI识别 | 多种图片格式、异常处理 |
| 文件管理 | 上传、预览、删除 |

### 兼容性测试

| 维度 | 测试范围 |
|------|----------|
| 微信版本 | 8.0+（基础库3.0+） |
| 设备 | iPhone SE ~ iPhone 15 Pro Max |
| 系统 | iOS 12+, Android 8+ |

### 性能测试

| 指标 | 目标值 |
|------|--------|
| 首页加载 | < 2s |
| 页面切换 | < 500ms |
| AI识别 | < 10s |
| 文件上传(5MB) | < 5s |

---

## 7.9 上线计划

### 提审准备

1. **材料准备**
   - 小程序名称：Syllaby 智课流
   - 类目：工具 > 效率
   - 简介：AI驱动的学业助理
   - 截图：5张核心功能截图

2. **合规检查**
   - 隐私政策完善
   - 用户协议完善
   - 数据收集说明
   - 权限使用说明

3. **代码检查**
   - 移除调试代码
   - 移除测试数据
   - 检查敏感信息

### 灰度发布

1. **内测阶段**
   - 邀请10-20名用户测试
   - 收集反馈和Bug

2. **小范围发布**
   - 开放100名用户使用
   - 监控数据和稳定性

3. **全量发布**
   - 正式上线
   - 持续监控和迭代

### 监控指标

| 指标 | 告警阈值 |
|------|----------|
| API错误率 | > 1% |
| 页面加载超时 | > 3s (P95) |
| AI调用失败率 | > 5% |
| 日活下降 | > 20% |

---

## 7.10 后续迭代

### v1.1 计划功能

- [ ] 桌面小组件
- [ ] 数据导入导出
- [ ] 更多主题色
- [ ] 学习报告

### v1.2 计划功能

- [ ] 教务系统对接
- [ ] 多用户协作
- [ ] 社区功能
- [ ] 高级AI功能

### 长期规划

- 跨平台（App/Web）
- AI个性化推荐
- 学习社区生态
- 商业化探索

---

## 7.11 资源需求

### 人力资源

| 角色 | 人数 | 职责 |
|------|------|------|
| 全栈开发 | 1 | 前后端开发 |
| UI设计 | 0.5 | 界面和图标设计 |
| 测试 | 0.5 | 功能和兼容性测试 |

### 技术资源

| 资源 | 规格 | 月成本 |
|------|------|--------|
| Supabase | Pro Plan | $25 |
| 腾讯云OCR | 按量 | ~¥600 |
| DeepSeek | 按量 | ~¥15 |
| 域名+备案 | - | ~¥100/年 |

### 工具资源

| 工具 | 用途 |
|------|------|
| GitHub | 代码托管 |
| Figma | UI设计 |
| Notion | 文档协作 |
| 微信开发者工具 | 开发调试 |

---

*文档结束*

---

## 附录：快速开始

### 开发环境搭建

```bash
# 1. 克隆项目
git clone <repo-url>
cd syllaby

# 2. 安装Supabase CLI
npm install -g supabase

# 3. 启动本地Supabase
supabase start

# 4. 应用数据库迁移
supabase db push

# 5. 部署Edge Functions
supabase functions deploy

# 6. 配置环境变量
supabase secrets set TENCENT_SECRET_ID=xxx
supabase secrets set DEEPSEEK_API_KEY=xxx

# 7. 打开微信开发者工具导入miniprogram目录
```

### 代码规范

- ESLint + Prettier
- 组件使用PascalCase
- 函数使用camelCase
- 常量使用UPPER_SNAKE_CASE
- 文件使用kebab-case

### Git工作流

```
main          # 生产分支
├── develop   # 开发分支
│   ├── feature/xxx  # 功能分支
│   └── fix/xxx      # 修复分支
└── release/x.x.x    # 发布分支
```

---

**文档完成日期**: 2025-11-21
**文档版本**: v1.0
**作者**: Claude Code

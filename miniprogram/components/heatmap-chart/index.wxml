<view class="heatmap-container {{variant}}" wx:if="{{weeks.length > 0}}">
  <!-- 洞察信息 -->
  <view class="insights-container" wx:if="{{showInsights && insights.length > 0}}">
    <view class="insight-item {{item.type}}" wx:for="{{insights}}" wx:key="type">
      <text class="insight-text">{{item.text}}</text>
    </view>
  </view>

  <!-- 连续天数展示 -->
  <view class="streak-container" wx:if="{{maxStreak > 0}}">
    <view class="streak-item">
      <text class="streak-label">当前连续</text>
      <text class="streak-value">{{currentStreak}} 天</text>
    </view>
    <view class="streak-item">
      <text class="streak-label">最长连续</text>
      <text class="streak-value">{{maxStreak}} 天</text>
    </view>
  </view>

  <!-- 月份标签 -->
  <view class="heatmap-months" wx:if="{{showMonths}}">
    <view class="month-cell" wx:for="{{months}}" wx:key="*this">
      {{item}}
    </view>
  </view>

  <!-- 热力图主体 -->
  <view class="heatmap-content">
    <!-- 星期标签 -->
    <view class="heatmap-weekdays" wx:if="{{showWeekdays}}">
      <view class="weekday-cell" wx:for="{{weekdays}}" wx:key="*this">
        {{item}}
      </view>
    </view>

    <!-- 热力图格子 -->
    <scroll-view class="heatmap-scroll" scroll-x="true" scroll-into-view="{{'week-' + (weeks.length - 1)}}">
      <view class="heatmap-grid">
        <view class="week-row" wx:for="{{weeks}}" wx:key="index" id="week-{{index}}">
          <view 
            class="day-cell {{item.isEmpty ? 'empty' : ''}} {{selectedDate && selectedDate.date === item.date ? 'selected' : ''}}" 
            wx:for="{{item}}" 
            wx:for-item="day" 
            wx:key="date"
            style="background-color: {{getColor(day.minutes)}}; animation-delay: {{index * 50 + day_index * 10}}ms"
            bindtap="onDayTap"
            data-day="{{day}}"
          >
            <view class="day-tooltip" wx:if="{{!day.isEmpty}}">
              <view class="tooltip-date">{{day.date}}</view>
              <view class="tooltip-minutes">专注 {{formatMinutes(day.minutes)}}</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 选中日期详情 -->
  <view class="selected-detail" wx:if="{{selectedDate}}">
    <text class="detail-date">{{selectedDate.date}}</text>
    <text class="detail-minutes">专注 {{formatMinutes(selectedDate.minutes)}}</text>
  </view>

  <!-- 图例 -->
  <view class="heatmap-legend">
    <text class="legend-text">少</text>
    <view class="legend-item" wx:for="{{colorLevels}}" wx:key="min" style="background-color: {{item.color}}"></view>
    <text class="legend-text">多</text>
  </view>
</view>

<view class="heatmap-container empty-state" wx:else>
  <view class="empty-inner">
    <view class="empty-orb orb-left"></view>
    <view class="empty-orb orb-right"></view>
    <text class="empty-title">投入日历</text>
    <text class="empty-desc">开始专注后会生成你的学习投入地图</text>
  </view>
</view>

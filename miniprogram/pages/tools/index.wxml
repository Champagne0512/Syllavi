<view class="tools-page">
  <custom-navbar title="Syllaby" subtitle="ä¸“æ³¨" />

  <scroll-view class="zen-scroll" scroll-y="true" enable-flex="true">
    <view class="hero-card">
      <view class="hero-content">
        <view class="hero-eyebrow">ä¸“æ³¨å®éªŒå®¤</view>
        <view class="hero-title">Flow Studio</view>
        <view class="hero-desc">æ ¹æ®ä¸åŒèŠ‚å¥åˆ‡æ¢ï¼Œæ›´å¿«è¿›å…¥å­¦ä¹ å¿ƒæµã€‚</view>
        <view class="hero-stats">
          <view class="hero-stat">
            <view class="stat-label">ä»Šæ—¥ä¸“æ³¨</view>
            <view class="stat-value">{{focusStats.todayFocus || 0}} min</view>
          </view>
          <view class="hero-stat">
            <view class="stat-label">ç´¯è®¡æ¬¡æ•°</view>
            <view class="stat-value">{{focusStats.totalSessions || 0}}</view>
          </view>
          <view class="hero-stat">
            <view class="stat-label">è¿ç»­å¤©æ•°</view>
            <view class="stat-value">{{focusStats.streakDays || 0}}</view>
          </view>
        </view>
      </view>
      <view class="hero-action" bindtap="goToFocus">
        <view class="icon-shape timer-icon"></view>
        <text>å¼€å§‹ä¸“æ³¨</text>
      </view>
      <view class="background-orb orb-left"></view>
      <view class="background-orb orb-right"></view>
    </view>

    <view class="tool-section pills-section">
      <view class="section-header">
        <view>
          <view class="section-title">èŠ‚å¥é¢æ¿</view>
          <view class="section-desc">é€‰æ‹©ä¸€ä¸ªèŠ‚å¥ï¼Œç›´æ¥è¿›å…¥ä¸“æ³¨é¡µ</view>
        </view>
      </view>
      <view class="pill-row">
        <view 
          class="focus-pill"
          wx:for="{{focusPills}}"
          wx:key="id"
          data-minutes="{{item.minutes}}"
          bindtap="goToPresetFocus"
        >
          <view class="pill-title">{{item.label}}</view>
          <view class="pill-desc">{{item.desc}}</view>
        </view>
      </view>
    </view>

    <view class="tool-section insights-section" wx:if="{{showStats}}">
      <view class="section-header">
        <view>
          <view class="section-title">ä¸“æ³¨æ¦‚è§ˆ</view>
          <view class="section-desc">è‡ªåŠ¨æ•´ç†çš„å­¦ä¹ æ´å¯Ÿ</view>
        </view>
      </view>
      <view class="insight-list">
        <view class="insight-item" wx:for="{{insightList}}" wx:key="id">
          <view class="insight-label">{{item.label}}</view>
          <view class="insight-value">{{item.value}}</view>
          <view class="insight-hint">{{item.hint}}</view>
        </view>
      </view>
    </view>

    <view class="data-grid" wx:if="{{showStats}}">
      <view class="data-card heat-card">
        <view class="card-head">
          <view>
            <view class="card-title">æŠ•å…¥æ—¥å†</view>
            <view class="card-desc">æœ€è¿‘ 12 ä¸ªæœˆ</view>
          </view>
        </view>
        <heatmap-chart 
          data="{{heatmapData}}"
          summary="{{heatmapSummary}}"
          variant="embedded"
          showInsights="{{true}}"
          bind:daytap="onHeatmapDayTap"
        ></heatmap-chart>
      </view>
    </view>

    <view class="tool-section achievements-section" wx:if="{{showStats && achievements.length > 0}}">
      <view class="section-header">
        <view>
          <view class="section-title">æˆå°±å¾½ç« </view>
          <view class="section-desc">å·²ç‚¹äº® {{achievementsMeta.unlocked}} / {{achievementsMeta.total}}</view>
        </view>
      </view>
      <view class="achievements-container">
        <view class="achievements-list">
          <holo-badge 
            wx:for="{{achievements}}" 
            wx:key="key"
            achievement="{{item}}"
            size="medium"
            showProgress="{{true}}"
            bind:badgeTap="onBadgeTap"
          ></holo-badge>
        </view>
      </view>
    </view>

    <!-- æˆå°±è¯¦æƒ…å¼¹çª— -->
    <view class="achievement-modal" wx:if="{{showAchievementModal}}" bindtap="closeAchievementModal">
      <view class="modal-content" catchtap="">
        <view class="modal-header">
          <view class="modal-badge">
            <text class="modal-icon" style="color: {{selectedAchievement.info.color}}">{{selectedAchievement.info.icon}}</text>
            <view class="modal-rarity rarity-{{selectedAchievement.info.rarity}}" wx:if="{{selectedAchievement.achievement.unlocked}}"></view>
          </view>
          <view class="modal-title-section">
            <text class="modal-title">{{selectedAchievement.info.name}}</text>
            <view class="modal-rarity-tag rarity-{{selectedAchievement.info.rarity}}">{{getRarityText(selectedAchievement.info.rarity)}}</view>
          </view>
          <view class="modal-close" bindtap="closeAchievementModal">âœ•</view>
        </view>
        
        <view class="modal-body">
          <text class="modal-desc">{{selectedAchievement.info.desc}}</text>
          
          <!-- è¿›åº¦ä¿¡æ¯ -->
          <view class="modal-progress" wx:if="{{!selectedAchievement.achievement.unlocked && selectedAchievement.progress > 0}}">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{selectedAchievement.progress}}%; background: {{selectedAchievement.info.color}}"></view>
            </view>
            <text class="progress-text">{{selectedAchievement.nextMilestone}}</text>
            <text class="progress-percent">{{Math.round(selectedAchievement.progress)}}%</text>
          </view>
          
          <!-- è§£é”çŠ¶æ€ -->
          <view class="modal-status">
            <view wx:if="{{selectedAchievement.achievement.unlocked}}" class="status-unlocked">
              <text class="status-icon">âœ¨</text>
              <text class="status-text">å·²è§£é”</text>
            </view>
            <view wx:else class="status-locked">
              <text class="status-icon">ğŸ”’</text>
              <text class="status-text">æœªè§£é”</text>
            </view>
          </view>
          
          <!-- è§£é”æ—¶é—´ -->
          <view class="modal-time" wx:if="{{selectedAchievement.achievement.unlocked && selectedAchievement.achievement.unlockedAt}}">
            <text class="time-label">è§£é”æ—¶é—´ï¼š</text>
            <text class="time-value">{{formatUnlockTime(selectedAchievement.achievement.unlockedAt)}}</text>
          </view>
        </view>
      </view>
    </view>

  </scroll-view>
</view>

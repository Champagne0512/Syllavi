<view class="container">
  <!-- æ¨¡å¼é€‰æ‹© -->
  <view class="mode-selector">
    <view 
      class="mode-item {{mode === 'auto' ? 'active' : ''}}"
      data-mode="auto"
      bindtap="switchMode"
    >
      æ™ºèƒ½è¯†åˆ«
    </view>
    <view 
      class="mode-item {{mode === 'course' ? 'active' : ''}}"
      data-mode="course"
      bindtap="switchMode"
    >
      è¯¾ç¨‹è¡¨è¯†åˆ«
    </view>
    <view 
      class="mode-item {{mode === 'task' ? 'active' : ''}}"
      data-mode="task"
      bindtap="switchMode"
    >
      å¾…åŠè¯†åˆ«
    </view>
  </view>

  <!-- å›¾ç‰‡é€‰æ‹©åŒºåŸŸ -->
  <view class="image-section" wx:if="{{!image && !scanning}}">
    <view class="upload-area" bindtap="chooseImage">
      <view class="upload-icon">ğŸ“·</view>
      <text class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</text>
      <text class="upload-hint">æ”¯æŒæ‹ç…§æˆ–ä»ç›¸å†Œé€‰æ‹©</text>
    </view>
  </view>

  <!-- å›¾ç‰‡é¢„è§ˆ -->
  <view class="image-preview" wx:if="{{image}}">
    <image src="{{image}}" mode="aspectFit" class="preview-image"></image>
  </view>

  <!-- æ‰«æè¿›åº¦ -->
  <view class="scanning-section" wx:if="{{scanning}}">
    <view class="scanning-animation">
      <view class="scanning-icon">ğŸ”</view>
      <text class="scanning-text">AIæ­£åœ¨åˆ†æå›¾ç‰‡...</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progress}}%"></view>
    </view>
    <text class="progress-text">{{progress}}%</text>
  </view>

  <!-- è¯†åˆ«ç»“æœ -->
  <view class="result-section" wx:if="{{result && !scanning}}">
    <view class="result-header">
      <text class="result-title">è¯†åˆ«ç»“æœ</text>
      <view class="result-type {{result.type}}">
        {{result.type === 'schedule' ? 'è¯¾ç¨‹è¡¨' : result.type === 'todo' ? 'å¾…åŠäº‹é¡¹' : 'æœªçŸ¥å†…å®¹'}}
      </view>
    </view>

    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <view class="debug-info" wx:if="{{debugInfo}}">
      <view class="debug-title">ğŸ”§ è°ƒè¯•ä¿¡æ¯</view>
      <view class="debug-item">ä»»åŠ¡ID: {{debugInfo.taskId}}</view>
      <view class="debug-item">çŠ¶æ€: {{debugInfo.status}}</view>
      <view class="debug-item">æ£€æŸ¥æ¬¡æ•°: {{debugInfo.checkCount}}</view>
      <view class="debug-item">åŸå§‹æ•°æ®:</view>
      <view class="debug-json">{{debugInfo.rawData}}</view>
    </view>

    <view class="result-content">
      <view wx:if="{{result.type === 'schedule'}}">
        <view class="course-list">
          <view class="course-item" wx:for="{{result.data}}" wx:key="index">
            <view class="course-name">{{item.name}}</view>
            <view class="course-details">
              å‘¨{{item.day}} ç¬¬{{item.start}}èŠ‚ ({{item.len}}èŠ‚) Â· {{item.location}}
            </view>
            <view class="course-teacher" wx:if="{{item.teacher}}">{{item.teacher}}</view>
          </view>
        </view>
      </view>

      <view wx:if="{{result.type === 'todo'}}">
        <view class="task-list">
          <view class="task-item" wx:for="{{result.data}}" wx:key="index">
            <view class="task-title">{{item.title}}</view>
            <view class="task-details" wx:if="{{item.description}}">{{item.description}}</view>
            <view class="task-deadline" wx:if="{{item.deadline}}">æˆªæ­¢: {{item.deadline}}</view>
          </view>
        </view>
      </view>

      <view wx:if="{{result.type === 'unknown'}}" class="unknown-result">
        <text class="unknown-text">æ— æ³•è¯†åˆ«å›¾ç‰‡å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¸…æ™°çš„å›¾ç‰‡</text>
        <view wx:if="{{debugInfo}}" class="unknown-debug">
          <text class="unknown-debug-text">AIè¿”å›äº†ç©ºæ•°æ®ï¼Œå¯èƒ½æ˜¯å› ä¸ºå›¾ç‰‡ä¸æ¸…æ™°æˆ–æ ¼å¼ä¸æ”¯æŒ</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="btn btn-secondary" bindtap="previewResult">æŸ¥çœ‹è¯¦æƒ…</button>
      <button class="btn btn-primary" bindtap="goToRelatedPage" wx:if="{{result.type !== 'unknown'}}">
        æŸ¥çœ‹{{result.type === 'schedule' ? 'è¯¾ç¨‹è¡¨' : 'å¾…åŠ'}}
      </button>
      <button class="btn btn-secondary" bindtap="retry">é‡æ–°è¯†åˆ«</button>
    </view>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-section" wx:if="{{error}}">
    <view class="error-icon">âŒ</view>
    <text class="error-text">{{error}}</text>
    <button class="btn btn-primary" bindtap="retry">é‡æ–°å°è¯•</button>
  </view>

  
</view>
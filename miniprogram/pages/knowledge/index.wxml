<view class="knowledge-page">
  <!-- 弥散背景 -->
  <view class="background-blob blob-1"></view>
  <view class="background-blob blob-2"></view>
  <view class="background-blob blob-3"></view>

  <custom-navbar title="Syllaby" subtitle="知识星图" />

  <scroll-view class="zen-scroll" scroll-y="true" enable-flex="true">

    <!-- 卡片式数据概览 -->
    <view class="data-overview">
      <view class="overview-card glass-card" bindtap="toggleZenMode">
        <view class="overview-icon">
          <view class="icon-shape library-icon"></view>
        </view>
        <view class="overview-content">
          <text class="overview-number">{{folders.length || 0}}</text>
          <text class="overview-label">知识分类</text>
        </view>
      </view>
      
      <view class="overview-card glass-card">
        <view class="overview-icon">
          <view class="icon-shape file-icon"></view>
        </view>
        <view class="overview-content">
          <text class="overview-number">{{files.length || 0}}</text>
          <text class="overview-label">文件资源</text>
        </view>
      </view>
      
      <view class="overview-card glass-card" bindtap="showMoodQuote">
        <view class="overview-icon">
          <view class="icon-shape ai-icon"></view>
        </view>
        <view class="overview-content">
          <text class="overview-number">AI</text>
          <text class="overview-label">智能划重点</text>
        </view>
      </view>
    </view>

    <!-- 心情日签 -->
    <view class="mood-quote" wx:if="{{showQuote}}">
      <text class="quote-text">{{currentQuote.text}}</text>
      <text class="quote-author">— {{currentQuote.author}}</text>
      <view class="quote-ornament"></view>
    </view>

    <!-- 文件夹网格 - 超级椭圆设计 -->
    <view class="folder-grid">
      <block wx:for="{{folders}}" wx:key="id">
        <view class="folder-card {{activeFolder === item.name ? 'active' : ''}}"
          style="--tone: {{item.tone}};"
          data-name="{{item.name}}"
          bindtap="selectFolder"
          bindlongpress="handleFolderLongPress">
          <view class="folder-gradient"></view>
      <view class="folder-content">
        <view class="folder-icon">
          <view class="icon-shape folder-icon-shape"></view>
        </view>
        <text class="folder-name">{{item.name}}</text>
        <text class="folder-count">{{item.count}} 项</text>
      </view>
          <view class="folder-hint">
            <text class="hint-text">点击探索</text>
            <view class="hint-arrow">→</view>
          </view>
        </view>
      </block>
    </view>

    <!-- 文件面板 - 玻璃拟态 -->
    <view class="file-panel glass-card">
      <view class="panel-header">
        <text class="panel-title">{{activeFolder}} 的文件</text>
        <view class="header-actions">
          <button class="action-btn upload-btn" bindtap="uploadResource">
            <view class="btn-icon-shape upload-icon"></view>
            <text class="btn-text">上传</text>
          </button>
          <view class="action-btn sort-btn" bindtap="toggleSort">
            <view class="btn-icon-shape sort-icon"></view>
            <text class="btn-text">{{sortOrder === 'asc' ? '升序' : '降序'}}</text>
          </view>
        </view>
      </view>

      <block wx:for="{{filteredFiles}}" wx:key="id">
        <view class="file-card"
          data-id="{{item.id}}"
          bindtap="previewFile"
          bindlongpress="handleFileLongPress">
          <view class="file-icon {{item.type}}">
            <view class="file-icon-shape {{item.type}}"></view>
            <view class="file-glow"></view>
          </view>
          <view class="file-content">
            <view class="file-header">
              <text class="file-name">{{item.name}}</text>
              <view class="file-codes">
                <text class="file-type-badge">{{item.type.toUpperCase()}}</text>
              </view>
            </view>
            <view class="file-meta">
              <text class="file-subject">{{item.subject}}</text>
              <text class="file-size" wx:if="{{item.size}}">{{formatSize(item.size)}}</text>
            </view>
            <view class="file-tags">
              <text class="tag-chip" wx:if="{{item.aiSummary}}">
                <view class="tag-icon ai-tag-icon"></view>
                AI 摘要
              </text>
              <text class="tag-chip previewable" wx:if="{{item.previewable}}">
                <view class="tag-icon preview-tag-icon"></view>
                可预览
              </text>
            </view>
          </view>
          <view class="file-action">
            <text class="action-text">查看</text>
            <view class="action-arrow">→</view>
          </view>
        </view>
      </block>

      <!-- 空状态艺术化 -->
      <view wx:if="{{!filteredFiles.length}}" class="empty-art">
        <view class="empty-illustration">
          <view class="empty-icon-shape"></view>
          <view class="empty-orbit"></view>
        </view>
        <text class="empty-title">知识星图等待探索</text>
        <text class="empty-subtitle">上传第一份资料，开始构建你的知识宇宙</text>
        <button class="empty-action" bindtap="uploadResource">
          <view class="empty-action-icon"></view>
          上传资料
        </button>
      </view>
    </view>

    <!-- 专注模式按钮 -->
    <view class="zen-mode-btn" bindtap="toggleZenMode">
      <view class="zen-icon-shape {{zenMode ? 'moon-icon' : 'sun-icon'}}"></view>
      <text class="zen-text">{{zenMode ? '退出专注' : '专注模式'}}</text>
    </view>
  </scroll-view>

  <!-- 专注模式遮罩 -->
  <view class="zen-overlay" wx:if="{{zenMode}}">
    <view class="zen-content">
      <text class="zen-title">专注知识探索</text>
      <text class="zen-quote">{{zenQuote}}</text>
      <view class="zen-controls">
        <button class="zen-btn" bindtap="playAmbientSound">
          <view class="zen-btn-icon music-icon"></view>
          环境音
        </button>
        <button class="zen-btn" bindtap="toggleZenMode">
          <view class="zen-btn-icon exit-icon"></view>
          退出
        </button>
      </view>
    </view>
  </view>
</view>

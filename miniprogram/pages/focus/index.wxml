<view class="focus-page" style="background-image: linear-gradient(160deg, {{gradients[gradientIndex][0]}}, {{gradients[gradientIndex][1]}});">
  <view class="floating-field">
    <view class="mesh-orb orb-a"></view>
    <view class="mesh-orb orb-b"></view>
    <view class="mesh-orb orb-c"></view>
  </view>

  <view class="focus-shell">
    <view class="top-bar">
      <view class="mood-quote">
        <text class="muted">Mood</text>
        <text class="quote">Flow stays when breathing stays.</text>
      </view>
      <button class="exit-btn" bindtap="exitFocus" wx:if="{{!running}}">âœ•</button>
    </view>

    <view class="course-pill" wx:if="{{courseName}}">
      <view class="pill-dot"></view>
      <text class="label">å½“å‰è¯¾ç¨‹</text>
      <text class="value mono">{{courseName}}</text>
    </view>

    <view class="hero-timer">
      <view class="halo-layer outer"></view>
      <view class="halo-layer inner"></view>
      <view class="breathing-dot {{running ? 'active' : ''}}"></view>
      <text class="hero-label">Focus Window</text>
      <text class="countdown mono">{{displayTime}}</text>
      <view class="hero-meta">
        <text class="mono">{{minutes}} min session</text>
        <text class="state {{running ? 'running' : 'idle'}}">{{running ? 'è¿›è¡Œä¸­' : 'å¾…å¼€å§‹'}}</text>
      </view>
    </view>

    <!-- ä¸»è¦æ“ä½œåŒº - ç‹¬ç«‹åœ¨æœ€é¡¶å±‚ -->
    <view class="main-action-area" wx:if="{{!running}}">
      <view class="action-card" bindtap="startFocus">
        <view class="action-content">
          <view class="action-icon">
            <text class="play-icon">â–¶</text>
          </view>
          <view class="action-text">
            <text class="action-title">å¼€å§‹ä¸“æ³¨</text>
            <text class="action-subtitle">{{minutes}} åˆ†é’Ÿ</text>
          </view>
        </view>
        <view class="action-arrow">â†’</view>
      </view>
    </view>

    <!-- è¿è¡Œä¸­çš„æ§åˆ¶é¢æ¿ -->
    <view class="running-panel" wx:if="{{running}}">
      <view class="stop-card" bindtap="stopFocus">
        <text class="stop-text">ç»“æŸä¸“æ³¨</text>
      </view>
    </view>

    <!-- æ—¶é•¿è°ƒèŠ‚å™¨ -->
    <view class="controls-panel" wx:if="{{!running}}">

      <view class="slider-block" wx:if="{{!running}}">
        <view class="slider-head">
          <text class="muted">æ—¶é•¿ (åˆ†é’Ÿ)</text>
          <text class="mono highlight">{{minutes}}</text>
        </view>
        <view class="slider-shell">
          <slider class="focus-slider" min="15" max="90" step="5" value="{{minutes}}" bindchange="adjustMinutes" />
          <view class="slider-glow"></view>
        </view>
        <view class="slider-ticks">
          <text>15</text>
          <text>30</text>
          <text>45</text>
          <text>60</text>
          <text>75</text>
          <text>90</text>
        </view>
        <view class="custom-time">
          <text class="muted small">è‡ªå®šä¹‰ 5-180 åˆ†é’Ÿ</text>
          <view class="custom-time-input">
            <input
              type="number"
              class="custom-input mono"
              value="{{customMinutesDraft}}"
              bindinput="onCustomMinutesInput"
              bindconfirm="applyCustomMinutes"
              confirm-type="done"
            />
            <text class="unit">min</text>
            <button class="apply-btn" bindtap="applyCustomMinutes">è®¾å®š</button>
          </view>
        </view>
      </view>
    </view>

    <view class="summary-card" wx:if="{{summaryCard}}">
      <view class="summary-head">
        <text>ä¸“æ³¨å¡ç‰‡</text>
        <view class="badge">Zen Record</view>
      </view>
      <view class="summary-grid">
        <view class="summary-item">
          <text class="muted">æœ¬æ¬¡ä¸“æ³¨</text>
          <text class="mono big">{{summaryCard.focus}}</text>
          <text class="unit">å°æ—¶</text>
        </view>
        <view class="summary-item">
          <text class="muted">è¿ç»­å¤©æ•°</text>
          <text class="mono big">{{summaryCard.streak}}</text>
          <text class="unit">days</text>
        </view>
      </view>
      <button class="ghost secondary" bindtap="saveCard">ä¿å­˜åˆ°ç›¸å†Œ</button>
      
        <!-- æ–°è§£é”æˆå°±å±•ç¤º -->
        <view class="new-achievements" wx:if="{{newAchievements.length > 0}}">
          <text class="new-achievements-title">ğŸ‰ æ–°æˆå°±è§£é”</text>
          <view class="new-achievements-list">
            <view class="new-achievement-item" wx:for="{{newAchievements}}" wx:key="*this">
              <text class="achievement-icon">{{getAchievementInfo(item).icon}}</text>
              <text class="achievement-name">{{getAchievementInfo(item).name}}</text>
            </view>
          </view>
        </view>
    </view>
  </view>

  <canvas canvas-id="focusCard" class="focus-canvas"></canvas>
</view>

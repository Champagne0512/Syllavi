<view class="focus-page" style="background-image: linear-gradient(160deg, {{gradients[gradientIndex][0]}}, {{gradients[gradientIndex][1]}});">
  <view class="floating-field">
    <view class="mesh-orb orb-a"></view>
    <view class="mesh-orb orb-b"></view>
    <view class="mesh-orb orb-c"></view>
  </view>

  <view class="focus-shell">
    <view class="top-bar">
      <view class="mood-quote">
        <text class="muted">Mood</text>
        <text class="quote">Flow stays when breathing stays.</text>
      </view>
      <button class="exit-btn" bindtap="exitFocus" wx:if="{{!running}}">âœ•</button>
    </view>

    <!-- æ•°æ®æ¦‚è§ˆ -->
    <view class="stats-overview" wx:if="{{!running}}">
      <view class="stat-item">
        <text class="stat-value">{{stats.todayMinutes || 0}}</text>
        <text class="stat-label">ä»Šæ—¥ä¸“æ³¨</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.streakDays || 0}}</text>
        <text class="stat-label">è¿ç»­å¤©æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.totalSessions || 0}}</text>
        <text class="stat-label">æ€»æ¬¡æ•°</text>
      </view>
      <view class="stat-item" bindtap="goToStats">
        <text class="stat-value">â†’</text>
        <text class="stat-label">è¯¦ç»†ç»Ÿè®¡</text>
      </view>
    </view>

    <view class="course-pill" wx:if="{{courseName}}">
      <view class="pill-dot"></view>
      <text class="label">å½“å‰è¯¾ç¨‹</text>
      <text class="value mono">{{courseName}}</text>
    </view>

    <view class="hero-timer">
      <view class="halo-layer outer"></view>
      <view class="halo-layer inner"></view>
      <view class="breathing-dot {{running ? 'active' : ''}}"></view>
      <text class="hero-label">Focus Window</text>
      <text class="countdown mono">{{displayTime}}</text>
      <view class="hero-meta">
        <text class="mono">{{minutes}} min session</text>
        <text class="state {{running ? 'running' : 'idle'}}">{{running ? 'è¿›è¡Œä¸­' : 'å¾…å¼€å§‹'}}</text>
      </view>
    </view>

    <view class="controls-panel">
      <view class="controls">
        <button class="primary" bindtap="startFocus" disabled="{{running}}">å¼€å§‹ä¸“æ³¨</button>
        <button class="ghost" bindtap="stopFocus" disabled="{{!running}}">ç»“æŸ</button>
      </view>

      <view class="slider-block" wx:if="{{!running}}">
        <view class="slider-head">
          <text class="muted">æ—¶é•¿ (åˆ†é’Ÿ)</text>
          <text class="mono highlight">{{minutes}}</text>
        </view>
        <view class="slider-shell">
          <slider class="focus-slider" min="15" max="90" step="5" value="{{minutes}}" bindchange="adjustMinutes" />
          <view class="slider-glow"></view>
        </view>
        <view class="slider-ticks">
          <text>15</text>
          <text>30</text>
          <text>45</text>
          <text>60</text>
          <text>75</text>
          <text>90</text>
        </view>
        <view class="custom-time">
          <text class="muted small">è‡ªå®šä¹‰ 5-180 åˆ†é’Ÿ</text>
          <view class="custom-time-input">
            <input
              type="number"
              class="custom-input mono"
              value="{{customMinutesDraft}}"
              bindinput="onCustomMinutesInput"
              bindconfirm="applyCustomMinutes"
              confirm-type="done"
            />
            <text class="unit">min</text>
            <button class="apply-btn" bindtap="applyCustomMinutes">è®¾å®š</button>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå°±å±•ç¤ºåŒº -->
    <view class="achievements-section" wx:if="{{!running}}">
      <view class="section-header">
        <text class="section-title">æˆå°±å¾½ç« </text>
        <text class="section-desc">è®°å½•ä½ çš„ä¸“æ³¨æˆé•¿</text>
      </view>
      <scroll-view class="achievements-scroll" scroll-x="true">
        <view class="achievements-list">
          <holo-badge 
            wx:for="{{achievements}}" 
            wx:key="key"
            achievement="{{item}}"
            size="medium"
            bind:badgeTap="onBadgeTap"
          ></holo-badge>
        </view>
      </scroll-view>
    </view>

    <view class="summary-card" wx:if="{{summaryCard}}">
      <view class="summary-head">
        <text>ä¸“æ³¨å¡ç‰‡</text>
        <view class="badge">Zen Record</view>
      </view>
      <view class="summary-grid">
        <view class="summary-item">
          <text class="muted">æœ¬æ¬¡ä¸“æ³¨</text>
          <text class="mono big">{{summaryCard.focus}}</text>
          <text class="unit">å°æ—¶</text>
        </view>
        <view class="summary-item">
          <text class="muted">è¿ç»­å¤©æ•°</text>
          <text class="mono big">{{summaryCard.streak}}</text>
          <text class="unit">days</text>
        </view>
      </view>
      <button class="ghost secondary" bindtap="saveCard">ä¿å­˜åˆ°ç›¸å†Œ</button>
      
      <!-- æ–°è§£é”æˆå°±å±•ç¤º -->
      <view class="new-achievements" wx:if="{{newAchievements.length > 0}}">
        <text class="new-achievements-title">ğŸ‰ æ–°æˆå°±è§£é”</text>
        <view class="new-achievements-list">
          <view class="new-achievement-item" wx:for="{{newAchievements}}" wx:key="*this">
            <text class="achievement-icon">{{focusService.getAchievementInfo(item).icon}}</text>
            <text class="achievement-name">{{focusService.getAchievementInfo(item).name}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <canvas canvas-id="focusCard" class="focus-canvas"></canvas>
</view>

<!--pages/groups/batch-tasks.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- æ ‡é¢˜æ  -->
    <view class="header">
      <text class="title">æ‰¹é‡å®‰æ’å°ç»„ä»»åŠ¡</text>
      <text class="subtitle">{{groupInfo.name}}</text>
    </view>

    <!-- ä»»åŠ¡è¡¨å• -->
    <view class="form-section">
      <view class="form-item">
        <text class="label">ä»»åŠ¡æ ‡é¢˜ *</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜" 
          value="{{taskForm.title}}"
          data-field="title"
          bindinput="onInputChange"
        />
      </view>

      <view class="form-item">
        <text class="label">ä»»åŠ¡æè¿°</text>
        <textarea 
          class="textarea" 
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰" 
          value="{{taskForm.description}}"
          data-field="description"
          bindinput="onInputChange"
          maxlength="500"
        />
      </view>

      <view class="form-item">
        <text class="label">æˆªæ­¢æ—¥æœŸ *</text>
        <picker 
          mode="date" 
          value="{{taskForm.deadline}}"
          bindchange="onDateChange"
        >
          <view class="picker">
            {{taskForm.deadline ? taskForm.deadline : 'è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ'}}
          </view>
        </picker>
      </view>

      <!-- åˆ†é…æ–¹å¼ -->
      <view class="form-item">
        <view class="switch-container">
          <text class="label">åˆ†é…ç»™å…¨ä½“æˆå‘˜</text>
          <switch 
            checked="{{taskForm.assignToAll}}"
            bindchange="onAssignToAllChange"
            color="#1989fa"
          />
        </view>
      </view>

      <!-- æˆå‘˜é€‰æ‹©ï¼ˆå½“ä¸é€‰æ‹©å…¨ä½“æˆå‘˜æ—¶æ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{!taskForm.assignToAll}}" class="members-section">
        <text class="section-title">é€‰æ‹©è¦åˆ†é…çš„æˆå‘˜ ({{taskForm.selectedMembers.length}}/{{members.length}})</text>
        <view class="members-list">
          <view 
            wx:for="{{members}}" 
            wx:key="id"
            class="member-item {{item.selected ? 'selected' : ''}}"
            data-index="{{index}}"
            bindtap="onMemberSelect"
          >
            <view class="member-info">
              <text class="member-name">{{item.role === 'leader' ? 'ğŸ‘‘ ' : ''}}{{item.nickname}}</text>
              <text class="member-role">{{item.role === 'leader' ? 'ç»„é•¿' : item.role === 'deputy_leader' ? 'å‰¯ç»„é•¿' : 'æˆå‘˜'}}</text>
            </view>
            <view class="checkbox {{item.selected ? 'checked' : ''}}">
              <text wx:if="{{item.selected}}">âœ“</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å¿«é€Ÿå¡«å†™ç¤ºä¾‹ -->
      <view class="example-section">
        <button class="example-btn" bindtap="fillExampleTask" size="mini">
          å¿«é€Ÿå¡«å†™ç¤ºä¾‹ä»»åŠ¡
        </button>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <view class="submit-section">
        <button 
          class="submit-btn" 
          bindtap="createBatchTasks"
          disabled="{{submitting}}"
          loading="{{submitting}}"
        >
          {{submitting ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºæ‰¹é‡ä»»åŠ¡'}}
        </button>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stats-item">
        <text class="stats-value">{{members.length}}</text>
        <text class="stats-label">å°ç»„æˆå‘˜</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{taskForm.assignToAll ? members.length : taskForm.selectedMembers.length}}</text>
        <text class="stats-label">å°†åˆ†é…ä»»åŠ¡</text>
      </view>
    </view>
  </view>
</view>
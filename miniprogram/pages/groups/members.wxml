<!--pages/groups/members.wxml-->
<view class="container">
  <!-- å¯¼èˆªæ ‡ç­¾ -->
  <view class="nav-tabs">
    <view 
      class="nav-tab {{currentTab === 'members' ? 'active' : ''}}"
      data-tab="members"
      bindtap="switchTab"
    >
      æˆå‘˜ç®¡ç†
    </view>
    <view 
      class="nav-tab {{currentTab === 'invitations' ? 'active' : ''}}"
      data-tab="invitations"
      bindtap="switchTab"
    >
      åŠ å…¥ç”³è¯·
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æˆå‘˜ç®¡ç† -->
  <view wx:if="{{!loading && currentTab === 'members'}}" class="tab-content">
    <view class="members-list">
      <view class="member-item" wx:for="{{members}}" wx:key="id">
        <image class="member-avatar" src="{{item.profiles.avatar_url || '/static/default-avatar.png'}}"></image>
        <view class="member-info">
          <view class="member-name">
            {{item.profiles.nickname}}
            <text wx:if="{{item.profiles.id === app.globalData.user.id}}" class="self-tag">(æˆ‘)</text>
          </view>
          <view class="member-meta">
            <text class="member-role {{item.role}}">
              {{item.role === 'leader' ? 'ç»„é•¿' : item.role === 'deputy_leader' ? 'å‰¯ç»„é•¿' : 'ç»„å‘˜'}}
            </text>
            <text class="join-time">åŠ å…¥æ—¶é—´ï¼š{{item.joined_at}}</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view wx:if="{{userRole === 'leader' && item.role === 'member'}}" class="member-actions">
          <button class="btn-small" data-id="{{item.id}}" bindtap="setDeputyLeader">è®¾ä¸ºå‰¯ç»„é•¿</button>
          <button class="btn-small danger" data-id="{{item.id}}" data-name="{{item.profiles.nickname}}" bindtap="removeMember">è¯·å‡º</button>
        </view>
        
        <view wx:if="{{userRole === 'leader' && item.role === 'deputy_leader'}}" class="member-actions">
          <button class="btn-small" data-id="{{item.id}}" bindtap="removeDeputyLeader">ç§»é™¤å‰¯ç»„é•¿</button>
          <button class="btn-small danger" data-id="{{item.id}}" data-name="{{item.profiles.nickname}}" bindtap="removeMember">è¯·å‡º</button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{members.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ‘¥</text>
      <view class="empty-text">æš‚æ— æˆå‘˜</view>
    </view>
  </view>

  <!-- åŠ å…¥ç”³è¯· -->
  <view wx:if="{{!loading && currentTab === 'invitations'}}" class="tab-content">
    <view class="invitations-list">
      <view class="invitation-item" wx:for="{{invitations}}" wx:key="id">
        <image class="invitation-avatar" src="{{item.profiles.avatar_url || '/static/default-avatar.png'}}"></image>
        <view class="invitation-info">
          <view class="invitation-name">{{item.profiles.nickname}}</view>
          <view class="invitation-time">ç”³è¯·æ—¶é—´ï¼š{{item.created_at}}</view>
        </view>
        
        <!-- å¤„ç†æŒ‰é’® -->
        <view wx:if="{{userRole === 'leader' || userRole === 'deputy_leader'}}" class="invitation-actions">
          <button class="btn-small success" data-id="{{item.id}}" data-action="accept" bindtap="handleInvitation">åŒæ„</button>
          <button class="btn-small danger" data-id="{{item.id}}" data-action="reject" bindtap="handleInvitation">æ‹’ç»</button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{invitations.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“¨</text>
      <view class="empty-text">æš‚æ— åŠ å…¥ç”³è¯·</view>
    </view>
  </view>
</view>
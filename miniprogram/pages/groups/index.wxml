<!--pages/groups/index.wxml-->
<view class="container">
  <!-- å¯¼èˆªæ  -->
  <view class="navbar">
    <view class="nav-tabs">
      <view 
        class="nav-tab {{currentTab === 'myGroups' ? 'active' : ''}}"
        data-tab="myGroups"
        bindtap="switchTab"
      >
        æˆ‘çš„å°ç»„
      </view>
      <view 
        class="nav-tab {{currentTab === 'publicGroups' ? 'active' : ''}}"
        data-tab="publicGroups"
        bindtap="switchTab"
      >
        å…¬å¼€å°ç»„
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æˆ‘çš„å°ç»„ -->
  <view wx:if="{{!loading && currentTab === 'myGroups'}}">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{userGroups.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“š</text>
      <view class="empty-text">æ‚¨è¿˜æ²¡æœ‰åŠ å…¥ä»»ä½•å°ç»„</view>
      <view class="empty-desc">å¿«æ¥åˆ›å»ºæˆ–åŠ å…¥ä¸€ä¸ªå­¦ä¹ å°ç»„å§ï¼</view>
      <view class="action-buttons">
        <button class="btn-primary" bindtap="createGroup">åˆ›å»ºå°ç»„</button>
        <button class="btn-secondary" bindtap="joinGroup">åŠ å…¥å°ç»„</button>
      </view>
    </view>

    <!-- å°ç»„åˆ—è¡¨ -->
    <view wx:else class="group-list">
      <view class="group-card" wx:for="{{userGroups}}" wx:key="group_id" data-id="{{item.group_id}}" bindtap="viewGroupDetail" catch:tap="viewGroupDetail">
        <view class="group-header">
          <image class="group-avatar" src="{{item.avatar_url || '/static/default-avatar.png'}}"></image>
          <view class="group-info">
            <view class="group-name">{{item.group_name}}</view>
            <view class="group-meta">
              <text class="role-tag {{item.member_role}}">{{item.member_role === 'leader' ? 'ç»„é•¿' : item.member_role === 'deputy_leader' ? 'å‰¯ç»„é•¿' : 'ç»„å‘˜'}}</text>
              <text class="member-count">{{item.member_count}}äºº</text>
            </view>
          </view>
        </view>
        <view class="group-description">{{item.group_description || 'æš‚æ— æè¿°'}}</view>
        <view class="group-actions">
          <button class="btn-small secondary" data-id="{{item.group_id}}" bindtap="viewGroupDetail" catchtap>æŸ¥çœ‹è¯¦æƒ…</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¬å¼€å°ç»„ -->
  <view wx:if="{{!loading && currentTab === 'publicGroups'}}">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{publicGroups.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸŒ</text>
      <view class="empty-text">æš‚æ— å…¬å¼€å°ç»„</view>
      <view class="empty-desc">æ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºç¬¬ä¸€ä¸ªå°ç»„ï¼</view>
      <button class="btn-primary" bindtap="createGroup">åˆ›å»ºå°ç»„</button>
    </view>

    <!-- å…¬å¼€å°ç»„åˆ—è¡¨ -->
    <view wx:else class="group-list">
      <view class="group-card" wx:for="{{publicGroups}}" wx:key="id" data-id="{{item.id}}" bindtap="viewGroupDetail">
        <view class="group-header">
          <image class="group-avatar" src="{{item.avatar_url || '/static/default-avatar.png'}}"></image>
          <view class="group-info">
            <view class="group-name">{{item.name}}</view>
            <view class="group-meta">
              <text class="member-count">å°ç»„ç ï¼š{{item.group_code}}</text>
            </view>
          </view>
        </view>
        <view class="group-description">{{item.description || 'æš‚æ— æè¿°'}}</view>
        <view class="group-actions">
          <button class="btn-small" data-code="{{item.group_code}}" bindtap="joinFromPublic" catchtap>ç”³è¯·åŠ å…¥</button>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view wx:if="{{!loading}}" class="floating-actions">
    <button class="fab" bindtap="createGroup">
      <text class="fab-text">+</text>
    </button>
    <button class="fab secondary" bindtap="joinGroup">
      <text class="fab-text">åŠ å…¥</text>
    </button>
  </view>
</view>
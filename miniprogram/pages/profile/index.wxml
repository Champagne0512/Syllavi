<view class="profile-page">
  <custom-navbar title="Syllaby" subtitle="ä¸ªäººä¸»é¡µ" />

  <scroll-view class="zen-scroll" scroll-y="true" enable-flex="true">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="card user-card">
      <view class="user-header">
        <view class="avatar-wrapper">
          <image
            class="avatar"
            src="{{profile.avatar_url || '/static/default-avatar.png'}}"
            mode="aspectFill"
          />
        </view>
        <view class="user-info">
          <view class="nickname">{{profile.nickname}}</view>
          <view class="school-info muted">
            <text wx:if="{{profile.school_name}}">{{profile.school_name}}</text>
            <text wx:if="{{profile.school_name && profile.grade}}"> Â· </text>
            <text wx:if="{{profile.grade}}">{{profile.grade}}</text>
          </view>
          <view class="bio muted" wx:if="{{profile.bio}}">{{profile.bio}}</view>
        </view>
        <view class="edit-btn" bindtap="editProfile">
          <text>ç¼–è¾‘</text>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ ç»Ÿè®¡å¡ç‰‡ -->
    <view class="card stats-card">
      <view class="section-head">
        <text>å­¦ä¹ ç»Ÿè®¡</text>
        <text class="muted mono">Learning Stats</text>
      </view>

      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-value">{{stats.today_focus_minutes}}</view>
          <view class="stat-label muted">ä»Šæ—¥ä¸“æ³¨(åˆ†é’Ÿ)</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.week_focus_minutes}}</view>
          <view class="stat-label muted">æœ¬å‘¨ä¸“æ³¨(åˆ†é’Ÿ)</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.continuous_days}}</view>
          <view class="stat-label muted">è¿ç»­å­¦ä¹ (å¤©)</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.total_sessions}}</view>
          <view class="stat-label muted">ä¸“æ³¨æ¬¡æ•°</view>
        </view>
      </view>

      <view class="divider"></view>

      <view class="stats-row">
        <view class="stats-row-item">
          <text class="row-icon">ğŸ“š</text>
          <view class="row-info">
            <text class="row-label muted">è¯¾ç¨‹æ•°</text>
            <text class="row-value">{{stats.total_courses}}</text>
          </view>
        </view>
        <view class="stats-row-item">
          <text class="row-icon">âœ…</text>
          <view class="row-info">
            <text class="row-label muted">å®Œæˆä»»åŠ¡</text>
            <text class="row-value">{{stats.completed_tasks}}/{{stats.total_tasks}}</text>
          </view>
        </view>
        <view class="stats-row-item">
          <text class="row-icon">ğŸ“</text>
          <view class="row-info">
            <text class="row-label muted">å­¦ä¹ èµ„æº</text>
            <text class="row-value">{{stats.total_resources}}</text>
          </view>
        </view>
      </view>

      <view class="total-focus">
        <view class="total-focus-label muted">ç´¯è®¡ä¸“æ³¨æ—¶é•¿</view>
        <view class="total-focus-value">
          <text class="focus-hours">{{stats.total_focus_minutes / 60}}</text>
          <text class="focus-unit">å°æ—¶</text>
        </view>
      </view>
    </view>

    <!-- æˆå°±ç³»ç»Ÿ -->
    <view class="card achievements-card">
      <view class="section-head">
        <text>æˆå°±å¾½ç« </text>
        <text class="muted mono">Achievements</text>
      </view>

      <view class="achievements-grid">
        <block wx:for="{{achievements}}" wx:key="id">
          <view
            class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
            data-achievement="{{item}}"
            bindtap="viewAchievement"
          >
            <view class="achievement-icon">{{item.icon}}</view>
            <view class="achievement-name">{{item.name}}</view>
            <view class="achievement-desc muted">{{item.desc}}</view>
            <view class="achievement-status" wx:if="{{!item.unlocked}}">ğŸ”’</view>
          </view>
        </block>
      </view>
    </view>

    <!-- å­¦ä¹ çƒ­åŠ›å›¾ -->
    <view class="card heatmap-card">
      <view class="section-head">
        <text>å­¦ä¹ çƒ­åŠ›å›¾</text>
        <text class="muted mono">Last 30 Days</text>
      </view>

      <view class="heatmap-grid">
        <block wx:for="{{heatmap}}" wx:key="date">
          <view
            class="heatmap-cell level-{{item.level}}"
            data-date="{{item.date}}"
            data-minutes="{{item.minutes}}"
          >
          </view>
        </block>
      </view>

      <view class="heatmap-legend">
        <text class="muted">å°‘</text>
        <view class="legend-cells">
          <view class="legend-cell level-0"></view>
          <view class="legend-cell level-1"></view>
          <view class="legend-cell level-2"></view>
          <view class="legend-cell level-3"></view>
          <view class="legend-cell level-4"></view>
        </view>
        <text class="muted">å¤š</text>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="card actions-card">
      <view class="section-head">
        <text>å¿«æ·æ“ä½œ</text>
        <text class="muted mono">Quick Actions</text>
      </view>

      <view class="actions-grid">
        <block wx:for="{{quickActions}}" wx:key="id">
          <view
            class="action-item"
            data-path="{{item.path}}"
            bindtap="navigateToAction"
          >
            <view class="action-icon">{{item.icon}}</view>
            <view class="action-name">{{item.name}}</view>
          </view>
        </block>
      </view>
    </view>
  </scroll-view>
</view>
